<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A tool to reduce image size">
    <title>Reducepic</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Reduce Your Pic</h1>
        <input type="file" id="fileInput" accept="image/*">
        <div class="resize-section">
            <label for="resizeInput">Percent of Size: </label>
            <input type="number" id="resizeInput" placeholder="Enter percentage (e.g., 1 to 99)">
        </div>
        <button id="resizeBtn">Process Now</button>
        <div id="imagePreview" style="display:none;">
            <h3>Uploaded Image</h3>
            <div class="image-preview" id="uploadedImagePreview">
                <img id="uploadedImage" src="" alt="Uploaded Image">
            </div>
        </div>
        <div id="result" class="result">
            <h3>Resized Image</h3>
            <div class="image-preview" id="resizedImagePreview">
                <img id="resizedImage" src="" alt="Resized Image">
            </div>
            <p id="finalSize"></p>
            <a id="downloadBtn" href="#" download="reducepic.jpg">
                <button>Download Resized Image</button>
            </a>
        </div>
        <div class="info" id="errorMessage"></div>
    </div>
    <script defer>
        let uploadedFile = null;

        document.addEventListener('change', function(event) {
            if (event.target.id === 'fileInput') {
                handleFileUpload(event);
            }
        });

        document.addEventListener('click', function(event) {
            if (event.target.id === 'resizeBtn') {
                handleResize();
            }
        });

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.getElementById('uploadedImage');
                    imgElement.src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    uploadedFile = file;
                    document.getElementById('errorMessage').textContent = '';
                };
                reader.readAsDataURL(file);
            }
        }

        function handleResize() {
            const resizeInput = document.getElementById('resizeInput').value;
            if (!uploadedFile) {
                document.getElementById('errorMessage').textContent = 'Please upload an image first.';
                return;
            }
            if (resizeInput <= 0 || isNaN(resizeInput)) {
                document.getElementById('errorMessage').textContent = 'Please enter a valid percentage.';
                return;
            }
            const resizePercentage = resizeInput / 100;
            processImage(resizePercentage);
        }

        function processImage(resizePercentage) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width * resizePercentage;
                    canvas.height = img.height * resizePercentage;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    canvas.toBlob(function(blob) {
                        const newSize = (blob.size / 1024).toFixed(2);
                        const newUrl = URL.createObjectURL(blob);
                        document.getElementById('resizedImage').src = newUrl;
                        document.getElementById('finalSize').textContent = `Final Image Size: ${newSize} KB`;
                        const downloadLink = document.getElementById('downloadBtn');
                        downloadLink.href = newUrl;
                        document.getElementById('result').style.display = 'block';
                    }, 'image/jpeg', 0.7);
                };
            };
            reader.readAsDataURL(uploadedFile);
        }
    </script>
</body>
</html>
